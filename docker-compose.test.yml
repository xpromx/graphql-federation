version: "3.9"

services:
  db:
    platform: linux/amd64
    image: mysql:8.0
    container_name: db-tests
    volumes:
      - ./docker/mysql/my.cnf:/etc/mysql/conf.d/my.cnf
      - ./docker/mysql/sql:/docker-entrypoint-initdb.d
    environment:
      - MYSQL_DATABASE=${DB_NAME}
      - MYSQL_USER=${DB_USER}
      - MYSQL_PASSWORD=${DB_PASS}
      - MYSQL_ROOT_PASSWORD=${DB_PASS}
      - TZ=${TZ}
    ports:
      - ${DB_PORT}:3306
  server:
    build: ./
    environment:
      - APOLLO_KEY=${APOLLO_KEY}
      - APOLLO_GRAPH_REF=${APOLLO_GRAPH_REF}
    ports:
      - "4001:4001"
    command: dev
    volumes:
      - .:/var/www/app:delegated
      - /var/www/app/node_modules
